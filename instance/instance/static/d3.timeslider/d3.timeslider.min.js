/* D3.TimeSlider - version 0.0.3 - 2013-09-17
 * See https://github.com/EOX-A/d3.TimeSlider for more information! */
!function(){var a,b=[].slice;a=function(){function a(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p=this;for(this.element=a,this.options=null!=b?b:{},this.debug=!0,this.svg=d3.select(a).append("svg").attr("class","timeslider"),this.options.width=this.svg[0][0].clientWidth,this.options.height=this.svg[0][0].clientHeight,(i=this.options).brush||(i.brush={}),(j=this.options.brush).start||(j.start=this.options.start),(k=this.options.brush).end||(k.end=new Date(new Date(this.options.brush.start).setDate(this.options.brush.start.getDate()+3))),this.data={},d=function(a){return function(b){var c,d;for(d=a.length-1,c=a[d];!c[1](b);)c=a[d--];return c[0](b)}},c=d([[d3.time.format("%Y"),function(){return!0}],[d3.time.format("%B %Y"),function(d){return d.getUTCMonth()}],[d3.time.format("%b %d %Y"),function(d){return 1!==d.getUTCDate()}],[d3.time.format("%b %d %Y "),function(d){return d.getUTCDay()&&1!==d.getUTCDate()}],[d3.time.format("%I %p"),function(d){return d.getUTCHours()}],[d3.time.format("%I:%M"),function(d){return d.getUTCMinutes()}],[d3.time.format(":%S"),function(d){return d.getUTCSeconds()}],[d3.time.format(".%L"),function(d){return d.getUTCMilliseconds()}]]),this.scales={x:d3.time.scale.utc().domain([this.options.domain.start,this.options.domain.end]).range([0,this.options.width]).nice()},this.axis={x:d3.svg.axis().scale(this.scales.x).innerTickSize(this.options.height-13).tickFormat(c)},this.svg.append("g").attr("class","axis").call(this.axis.x),d3.select(this.element).select("g.axis .domain").attr("transform","translate(0, "+(b.height-18)+")"),this.brush=d3.svg.brush().x(this.scales.x).on("brushstart",function(){return p.options.lastZoom={scale:p.options.zoom.scale(),translate:[p.options.zoom.translate()[0],p.options.zoom.translate()[1]]},p.options.zoom.on("zoom",null)}).on("brushend",function(){return p.options.zoom.scale(p.options.lastZoom.scale).translate(p.options.lastZoom.translate).on("zoom",h),a.dispatchEvent(new CustomEvent("selectionChanged",{detail:{start:p.brush.extent()[0],end:p.brush.extent()[1]},bubbles:!0,cancelable:!0}))}).extent([this.options.brush.start,this.options.brush.end]),this.svg.append("g").attr("class","brush").call(this.brush).selectAll("rect").attr("height",""+(this.options.height-19)).attr("y",0),this.svg.append("g").attr("class","datasets").attr("width",this.options.width).attr("height",this.options.height).attr("transform","translate(0, "+(b.height-23)+")"),this.drawDataset=function(a){var b;return p.svg.select("g.datasets").append("g").attr("class","dataset").attr("id","dataset-"+a.id),b=p.svg.select("g.datasets #dataset-"+a.id),null==p.options.datasetIndex&&(p.options.datasetIndex=0),p.data[a.id]={index:p.options.datasetIndex++,color:a.color,callback:a.data,points:[],ranges:[]},p.updateDataset(a.id)},this.updateDataset=function(a){var d,b,c,d,e,f,g,h;for(c=p.svg.select("g.datasets #dataset-"+a),d=p.data[a],d.ranges=[],d.points=[],h=d.callback(p.scales.x.domain()[0],p.scales.x.domain()[1]),f=0,g=h.length;g>f;f++)b=h[f],b.length>1?d.ranges.push(b):d.points.push(b[0]);return c.selectAll("path").remove(),e=c.selectAll("path").data(d.ranges),e.enter().append("path").attr("d",d3.svg.line().x(function(d){return p.scales.x(d)}).y(-5*d.index).interpolate("linear")).attr("stroke",d.color),e.exit().remove(),c.selectAll("circle").remove(),d=c.selectAll("circle").data(d.points).remove(),d.enter().append("circle").attr("cx",function(d){return p.scales.x(d)}).attr("cy",""+-5*d.index).attr("fill",d.color).attr("r",2),d.exit().remove()},o=this.options.datasets,l=function(a){return p.drawDataset(a)},m=0,n=o.length;n>m;m++)e=o[m],l(e);f=function(){var a;p.brush.x(p.scales.x).extent(p.brush.extent()),d3.select(p.element).select("g.axis").call(p.axis.x),d3.select(p.element).select("g.brush").call(p.brush),a=[];for(e in p.data)a.push(p.updateDataset(e));return a},g=function(){return p.options.width=d3.select(p.element).select("svg.timeslider")[0][0].clientWidth,p.scales.x.range([0,p.options.width]),f()},d3.select(window).on("resize",g),h=function(){return f()},this.options.zoom=d3.behavior.zoom().x(this.scales.x).size([this.options.width,this.options.height]).scaleExtent([1,1/0]).on("zoom",h),this.svg.call(this.options.zoom)}return a.prototype.hide=function(){return this.originalDisplay=this.element.style.display,this.element.style.display="none",!0},a.prototype.show=function(){return this.element.style.display=this.originalDisplay,!0},a.prototype.select=function(){var a,c,d;return c=1<=arguments.length?b.call(arguments,0):[],d=new Date(c[0]),d<this.options.start&&(d=this.options.start),a=new Date(c[1]),a>this.options.end&&(a=this.options.end),d3.select(this.element).select("g.brush").call(this.brush.extent([d,a])),this.element.dispatchEvent(new CustomEvent("selectionChanged",{detail:{start:this.brush.extent()[0],end:this.brush.extent()[1]},bubbles:!0,cancelable:!0})),!0},a.prototype.addDataset=function(a){return this.drawDataset(a),!0},a.prototype.removeDataset=function(a){var b,c;if(null==this.data[a])return!1;c=this.data[a].index,delete this.data[a],d3.select(this.element).select("g.dataset#dataset-"+a).remove();for(b in this.data)this.data[b].index>c&&(this.data[b].index-=1),this.updateDataset(b);return!0},a.prototype.center=function(){var a;return a=1<=arguments.length?b.call(arguments,0):[],!0},a.prototype.zoom=function(){var a,c,d,e,f=this;return c=1<=arguments.length?b.call(arguments,0):[],d=new Date(c[0]),a=new Date(c[1]),d>a&&(e=[a,d],d=e[0],a=e[1]),d3.transition().duration(750).tween("zoom",function(){var b;return b=d3.interpolate(f.options.zoom.scale(),(f.options.domain.end-f.options.domain.start)/(a-d)),function(a){var c,e,g;e=d3.interpolate(f.options.zoom.translate()[0],f.options.zoom.translate()[0]-f.scales.x(d)),f.options.zoom.scale(b(a)),f.options.zoom.translate([e(a),0]),f.brush.x(f.scales.x).extent(f.brush.extent()),d3.select(f.element).select("g.axis").call(f.axis.x),d3.select(f.element).select("g.brush").call(f.brush),g=[];for(c in f.data)g.push(f.updateDataset(c));return g}}),!0},a}(),this.TimeSlider=a}.call(this);